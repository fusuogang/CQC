<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta name="baidu-tc-verification" content="0fb041a64ee71333c957d8c784961cc8" />
<meta property="qc:admins" content="145637425211673116375" />
<meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<title>Python爬虫实战二之爬取百度贴吧帖子 | 静觅</title>
<script>
window._deel = {name: '静觅',url: 'http://cuiqingcai.com/wp-content/themes/Yusi', ajaxpager: 'on', commenton: 1, roll: [0,0]}
</script>

<!-- All in One SEO Pack 2.2.7.5 by Michael Torbert of Semper Fi Web Design[392,430] -->
<meta name="description" itemprop="description" content="大家好，上次我们实验了爬取了糗事百科的段子，那么这次我们来尝试一下爬取百度贴吧的帖子。与上一篇不同的是，这次我们需要用到文件的相关操作。 本篇目标 1.对百度贴吧的任意帖子进行抓取 2.指定是否只抓取楼主发帖内容 3.将抓取到的内容分析并保存到文件 1.URL格式的确定 首先，我们先观察一下百度贴吧" />

<meta name="keywords" itemprop="keywords" content="python,爬虫" />

<!-- /all in one seo pack -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/cuiqingcai.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.5"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-github-css'  href='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/themes/github/github.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='page-list-style-css'  href='http://cuiqingcai.com/wp-content/plugins/sitemap/css/page-list.css?ver=4.3' type='text/css' media='all' />
<link rel='stylesheet' id='style-css'  href='http://cuiqingcai.com/wp-content/themes/Yusi/style.css?ver=33' type='text/css' media='all' />
<script type='text/javascript' src='//libs.baidu.com/jquery/1.8.3/jquery.min.js?ver=1.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.7.1","is_admin":"0","ajaxurl":"http:\/\/cuiqingcai.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"\u4f7f\u7528 %s \u590d\u5236\uff0c\u4f7f\u7528 %s \u7c98\u8d34\u3002","minimize":"\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801"};
/* ]]> */
</script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=2.7.1'></script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/themes/Yusi/js/jquery.fitvids.js?ver=2.0.110526'></script>
<link rel='prev' title='Python爬虫实战一之爬取糗事百科段子' href='http://cuiqingcai.com/990.html' />
<link rel='next' title='Python爬虫实战三之计算大学本学期绩点' href='http://cuiqingcai.com/997.html' />
<link rel='canonical' href='http://cuiqingcai.com/993.html' />
<link rel='shortlink' href='http://cuiqingcai.com/?p=993' />
<meta name="keywords" content="Python, 爬虫, Python">
<meta name="description" content="大家好，上次我们实验了爬取了糗事百科的段子，那么这次我们来尝试一下爬取百度贴吧的帖子。与上一篇不同的是，这次我们需要用到文件的相关操作。 本篇目标 1.对百度贴吧的任意帖子进行抓取  2.指定是否只抓取楼主发帖内容  3.将抓取到的内容分析并保存到文件 1.URL格式的确定 首先，我们先观察一下百度贴吧的任意一个帖子。  比如：http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1，这">
        <script type="text/javascript">
            jQuery(document).ready( function() {
                jQuery('.video').fitVids();
            });
        </script><!--[if lt IE 9]><script src="http://cuiqingcai.com/wp-content/themes/Yusi/js/html5.js"></script><![endif]-->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3ef185224776ec2561c9f7066ead4f24";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta name="360-site-verification" content="bdc579accc68a98f1258ebcce2266afa" />
<script type="text/javascript" name="baidu-tc-cerfication" data-appid="5411405" src="http://apps.bdimg.com/cloudaapi/lightapp.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="http://cuiqingcai.com/fav.png" />
<script type="text/javascript" src="http://cuiqingcai.com/wp-content/themes/Yusi/js/main.js"></script>
<script type="text/javascript">

</script>
</head>
<body class="single single-post postid-993 single-format-standard">

<header id="header" class="header">
<div class="container-inner">
 <div class="yusi-logo">
                    <a href="/">
                        <h1>
                                                        <span class="yusi-mono">静觅</span>
                                                        <span class="yusi-bloger">静静寻觅生活的美好</span>
                                                    </h1>
                    </a>
    </div>
</div>

	<div id="nav-header" class="navbar">
		
		<ul class="nav">
			<li id="menu-item-44" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-44"><a href="http://cuiqingcai.com">首页</a></li>
<li id="menu-item-14" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-14"><a href="http://cuiqingcai.com/category/life">生活笔记</a>
<ul class="sub-menu">
	<li id="menu-item-19" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-19"><a href="http://cuiqingcai.com/category/life/notes">个人随笔</a></li>
	<li id="menu-item-18" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-18"><a href="http://cuiqingcai.com/category/life/daily">个人日记</a></li>
	<li id="menu-item-15" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-15"><a href="http://cuiqingcai.com/category/life/presatation">个人展示</a></li>
</ul>
</li>
<li id="menu-item-7" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-7"><a href="http://cuiqingcai.com/category/technique">技术杂谈</a>
<ul class="sub-menu">
	<li id="menu-item-9" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9"><a href="http://cuiqingcai.com/category/technique/cc">C/C++</a></li>
	<li id="menu-item-11" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11"><a href="http://cuiqingcai.com/category/technique/java">Java</a></li>
	<li id="menu-item-17" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-17"><a href="http://cuiqingcai.com/category/technique/php">PHP</a></li>
	<li id="menu-item-153" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-153"><a href="http://cuiqingcai.com/category/technique/html">HTML</a></li>
	<li id="menu-item-960" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-960"><a href="http://cuiqingcai.com/category/technique/python">Python</a></li>
	<li id="menu-item-1277" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1277"><a href="http://cuiqingcai.com/category/technique/javascript">JS</a></li>
	<li id="menu-item-16" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16"><a href="http://cuiqingcai.com/category/technique/other">Other</a></li>
</ul>
</li>
<li id="menu-item-418" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-418"><a href="http://cuiqingcai.com/category/resources">福利专区</a></li>
<li id="menu-item-851" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-851"><a href="http://cuiqingcai.com/about">关于自己</a></li>
<li id="menu-item-251" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-251"><a href="http://cuiqingcai.com/contact">给我留言</a></li>
<li id="menu-item-1131" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1131"><a href="http://cuiqingcai.com/donate">赞助作者</a></li>
<li style="float:right;">
                    <div class="toggle-search"><i class="fa fa-search"></i></div>
<div class="search-expand" style="display: none;"><div class="search-expand-inner"><form method="get" class="searchform themeform" onsubmit="location.href='http://cuiqingcai.com/?s=' + encodeURIComponent(this.s.value).replace(/%20/g, '+'); return false;" action="/"><div> <input type="ext" class="search" name="s" onblur="if(this.value=='')this.value='search...';" onfocus="if(this.value=='search...')this.value='';" value="search..."></div></form></div></div>
</li>
		</ul>
	</div>
	</div>
</header>
<section class="container"><div class="speedbar">
					<div class="pull-right">
				<i class="fa fa-user"></i> <a href="/wp-login.php?action=register">投稿</a>&nbsp;&nbsp;&nbsp;   <i class="fa fa-power-off"></i> <a href="http://cuiqingcai.com/wp-login.php">登录</a>			</div>
				<div class="toptip"><strong class="text-success"><i class="fa fa-volume-up"></i> </strong>    欢迎来到我的博客，浏览文章时点击一下广告是您对我最大的支持，谢谢啦！</div>
	</div>
	<div class="content-wrap">
	<div class="content">
<div class="breadcrumbs"><a title="返回首页" href="http://cuiqingcai.com"><i class="fa fa-home"></i></a> <small>></small> <a href="http://cuiqingcai.com/category/technique">技术杂谈</a> <small>></small> <a href="http://cuiqingcai.com/category/technique/python">Python</a> <small>></small> <span class="muted">Python爬虫实战二之爬取百度贴吧帖子</span></div>
				<header class="article-header">
			<h1 class="article-title"><a href="http://cuiqingcai.com/993.html">Python爬虫实战二之爬取百度贴吧帖子</a></h1>
			<div class="meta">
				<span id="mute-category" class="muted"><i class="fa fa-list-alt"></i><a href="http://cuiqingcai.com/category/technique/python"> Python</a></span>				<span class="muted"><i class="fa fa-user"></i> <a href="http://cuiqingcai.com/author/cqcre">崔庆才</a></span>
				<time class="muted"><i class="fa fa-clock-o"></i> 12个月前 (02-16)</time>
				<span class="muted"><i class="fa fa-eye"></i> 31564℃</span>
				<span class="muted"><i class="fa fa-comments-o"></i> <a href="http://cuiqingcai.com/993.html#comments">65评论</a></span>							</div>
		</header>
<div class="banner banner-post"><!-- tuici -->
<script type="text/javascript">
    /* 创建于 2015-02-23*/
var cpro_id = "u1959022";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/cnw.js" type="text/javascript"></script>
<!-- biaoqian -->
<script type="text/javascript">
    /*860*60 创建于 2015-02-25*/
    var cpro_id = "u1959939";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

</div>		<article class="article-content">
			<p>大家好，上次我们实验了爬取了糗事百科的段子，那么这次我们来尝试一下爬取百度贴吧的帖子。与上一篇不同的是，这次我们需要用到文件的相关操作。</p>
<h2>本篇目标</h2>
<p>1.对百度贴吧的任意帖子进行抓取</p>
<p>2.指定是否只抓取楼主发帖内容</p>
<p>3.将抓取到的内容分析并保存到文件</p>
<h2>1.URL格式的确定</h2>
<p>首先，我们先观察一下百度贴吧的任意一个帖子。</p>
<p>比如：<a href="http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1">http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1</a>，这是一个关于NBA50大的盘点，分析一下这个地址。</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532131691438162" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 http://  代表资源传输使用http协议
 tieba.baidu.com 是百度的二级域名，指向百度贴吧的服务器。
 /p/3138733512 是服务器某个资源，即这个帖子的地址定位符
 see_lz和pn是该URL的两个参数，分别代表了只看楼主和帖子页码，等于1表示该条件为真</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532131691438162-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532131691438162-2">2</div><div class="crayon-num" data-line="crayon-56bca5b532131691438162-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532131691438162-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532131691438162-1"><span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//&nbsp;&nbsp;代表资源传输使用http协议</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532131691438162-2"><span class="crayon-h"> </span><span class="crayon-v">tieba</span><span class="crayon-sy">.</span><span class="crayon-v">baidu</span><span class="crayon-sy">.</span><span class="crayon-i">com</span><span class="crayon-h"> </span>是百度的二级域名，指向百度贴吧的服务器。</div><div class="crayon-line" id="crayon-56bca5b532131691438162-3"><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">/</span><span class="crayon-cn">3138733512</span><span class="crayon-h"> </span>是服务器某个资源，即这个帖子的地址定位符</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532131691438162-4"><span class="crayon-h"> </span><span class="crayon-v">see</span><span class="crayon-sy">_</span>lz和<span class="crayon-i">pn</span>是该<span class="crayon-i">URL</span>的两个参数，分别代表了只看楼主和帖子页码，等于<span class="crayon-cn">1</span>表示该条件为真</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>所以我们可以把URL分为两部分，一部分为基础部分，一部分为参数部分。</p>
<p>例如，上面的URL我们划分基础部分是 <a href="http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1">http://tieba.baidu.com/p/3138733512</a>，参数部分是 <a href="http://tieba.baidu.com/p/3138733512?see_lz=1&amp;pn=1">?see_lz=1&amp;pn=1</a></p>
<h2>2.页面的抓取</h2>
<p>熟悉了URL的格式，那就让我们用urllib2库来试着抓取页面内容吧。上一篇糗事百科我们最后改成了面向对象的编码方式，这次我们直接尝试一下，定义一个类名叫BDTB(百度贴吧)，一个初始化方法，一个获取页面的方法。</p>
<p>其中，有些帖子我们想指定给程序是否要只看楼主，所以我们把只看楼主的参数初始化放在类的初始化上，即init方法。另外，获取页面的方法我们需要知道一个参数就是帖子页码，所以这个参数的指定我们放在该方法中。</p>
<p>综上，我们初步构建出基础代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b53214c644455077" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
__author__ = 'CQC'
# -*- coding:utf-8 -*-
import urllib
import urllib2
import re

#百度贴吧爬虫类
class BDTB:

    #初始化，传入基地址，是否只看楼主的参数
    def __init__(self,baseUrl,seeLZ):
        self.baseURL = baseUrl
        self.seeLZ = '?see_lz='+str(seeLZ)

    #传入页码，获取该页帖子的代码
    def getPage(self,pageNum):
        try:
            url = self.baseURL+ self.seeLZ + '&amp;pn=' + str(pageNum)
            request = urllib2.Request(url)
            response = urllib2.urlopen(request)
            print response.read()
            return response
        except urllib2.URLError, e:
            if hasattr(e,"reason"):
                print u"连接百度贴吧失败,错误原因",e.reason
                return None

baseURL = 'http://tieba.baidu.com/p/3138733512'
bdtb = BDTB(baseURL,1)
bdtb.getPage(1)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-2">2</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-4">4</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-6">6</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-8">8</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-10">10</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-12">12</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-14">14</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-16">16</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-18">18</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-20">20</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-22">22</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-24">24</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-26">26</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-28">28</div><div class="crayon-num" data-line="crayon-56bca5b53214c644455077-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53214c644455077-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b53214c644455077-1"><span class="crayon-v">__author__</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'CQC'</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-2"><span class="crayon-p"># -*- coding:utf-8 -*-</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-3"><span class="crayon-e">import </span><span class="crayon-e">urllib</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-4"><span class="crayon-e">import </span><span class="crayon-e">urllib2</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-5"><span class="crayon-e">import </span><span class="crayon-v">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-6">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b53214c644455077-7"><span class="crayon-p">#百度贴吧爬虫类</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-8"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">BDTB</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#初始化，传入基地址，是否只看楼主的参数</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">baseUrl</span><span class="crayon-sy">,</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">baseURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">baseUrl</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-13"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'?see_lz='</span><span class="crayon-o">+</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-14">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b53214c644455077-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#传入页码，获取该页帖子的代码</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">baseURL</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;pn='</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">request</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">Request</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">response</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-23"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">except </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-v">URLError</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">hasattr</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-s">"reason"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">"连接百度贴吧失败,错误原因"</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">reason</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-26"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">None</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-28"><span class="crayon-v">baseURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://tieba.baidu.com/p/3138733512'</span></div><div class="crayon-line" id="crayon-56bca5b53214c644455077-29"><span class="crayon-v">bdtb</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BDTB</span><span class="crayon-sy">(</span><span class="crayon-v">baseURL</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53214c644455077-30"><span class="crayon-v">bdtb</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0047 seconds] -->
<p>运行代码，我们可以看到屏幕上打印出了这个帖子第一页楼主发言的所有内容，形式为HTML代码。</p>
<p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219162232.jpg"><img class="alignnone size-full wp-image-1020" src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219162232.jpg" alt="20150219162232" width="1344" height="537" /></a></p>
<h2>3.提取相关信息</h2>
<h3>1）提取帖子标题</h3>
<p>首先，让我们提取帖子的标题。</p>
<p>在浏览器中审查元素，或者按F12，查看页面源代码，我们找到标题所在的代码段，可以发现这个标题的HTML代码是</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532159627729655" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;h1 class="core_title_txt  " title="纯原创我心中的NBA2014-2015赛季现役50大" style="width: 396px"&gt;纯原创我心中的NBA2014-2015赛季现役50大&lt;/h1&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532159627729655-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532159627729655-1"><span class="crayon-o">&lt;</span><span class="crayon-e">h1 </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"core_title_txt  "</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-o">=</span><span class="crayon-s">"纯原创我心中的NBA2014-2015赛季现役50大"</span><span class="crayon-h"> </span><span class="crayon-v">style</span><span class="crayon-o">=</span><span class="crayon-s">"width: 396px"</span><span class="crayon-o">&gt;</span>纯原创我心中的<span class="crayon-v">NBA2014</span><span class="crayon-o">-</span><span class="crayon-cn">2015</span>赛季现役<span class="crayon-cn">50</span>大<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h1</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>所以我们想提取&lt;h1&gt;标签中的内容，同时还要指定这个class确定唯一，因为h1标签实在太多啦。</p>
<p>正则表达式如下</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532162096176722" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532162096176722-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532162096176722-1"><span class="crayon-o">&lt;</span><span class="crayon-e">h1 </span><span class="crayon-t">class</span><span class="crayon-o">=</span>"<span class="crayon-v">core_title_txt</span><span class="crayon-sy">.</span><span class="crayon-o">*</span><span class="crayon-sy">?</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-o">*</span><span class="crayon-sy">?</span><span class="crayon-sy">)</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h1</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>所以，我们增加一个获取页面标题的方法</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532168655010729" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#获取帖子标题
def getTitle(self):
    page = self.getPage(1)
    pattern = re.compile('&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;',re.S)
    result = re.search(pattern,page)
    if result:
        #print result.group(1)  #测试输出
        return result.group(1).strip()
    else:
        return None</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532168655010729-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532168655010729-2">2</div><div class="crayon-num" data-line="crayon-56bca5b532168655010729-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532168655010729-4">4</div><div class="crayon-num" data-line="crayon-56bca5b532168655010729-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532168655010729-6">6</div><div class="crayon-num" data-line="crayon-56bca5b532168655010729-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532168655010729-8">8</div><div class="crayon-num" data-line="crayon-56bca5b532168655010729-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532168655010729-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532168655010729-1"><span class="crayon-p">#获取帖子标题</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532168655010729-2"><span class="crayon-e">def </span><span class="crayon-e">getTitle</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532168655010729-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532168655010729-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532168655010729-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532168655010729-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532168655010729-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#print result.group(1)&nbsp;&nbsp;#测试输出</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532168655010729-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">group</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532168655010729-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532168655010729-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
<p></p>
<h3>2）提取帖子页数</h3>
<p>同样地，帖子总页数我们也可以通过分析页面中的共?页来获取。所以我们的获取总页数的方法如下</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b53216e842883349" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#获取帖子一共有多少页
def getPageNum(self):
    page = self.getPage(1)
    pattern = re.compile('&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;',re.S)
    result = re.search(pattern,page)
    if result:
        #print result.group(1)  #测试输出
        return result.group(1).strip()
    else:
        return None</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b53216e842883349-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53216e842883349-2">2</div><div class="crayon-num" data-line="crayon-56bca5b53216e842883349-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53216e842883349-4">4</div><div class="crayon-num" data-line="crayon-56bca5b53216e842883349-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53216e842883349-6">6</div><div class="crayon-num" data-line="crayon-56bca5b53216e842883349-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53216e842883349-8">8</div><div class="crayon-num" data-line="crayon-56bca5b53216e842883349-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53216e842883349-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b53216e842883349-1"><span class="crayon-p">#获取帖子一共有多少页</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53216e842883349-2"><span class="crayon-e">def </span><span class="crayon-e">getPageNum</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53216e842883349-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53216e842883349-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53216e842883349-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53216e842883349-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53216e842883349-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#print result.group(1)&nbsp;&nbsp;#测试输出</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53216e842883349-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">group</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53216e842883349-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53216e842883349-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0021 seconds] -->
<p></p>
<h3>3）提取正文内容</h3>
<p>审查元素，我们可以看到百度贴吧每一层楼的主要内容都在&lt;div id=&#8221;post_content_xxxx&#8221;&gt;&lt;/div&gt;标签里面，所以我们可以写如下的正则表达式</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532174381127282" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532174381127282-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532174381127282-1"><span class="crayon-o">&lt;</span><span class="crayon-e">div </span><span class="crayon-v">id</span><span class="crayon-o">=</span>"<span class="crayon-v">post_content_</span><span class="crayon-sy">.</span><span class="crayon-o">*</span><span class="crayon-sy">?</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">.</span><span class="crayon-o">*</span><span class="crayon-sy">?</span><span class="crayon-sy">)</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">div</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>相应地，获取页面所有楼层数据的方法可以写成如下方法</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532179908865533" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#获取每一层楼的内容,传入页面内容
def getContent(self,page):
    pattern = re.compile('&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S)
    items = re.findall(pattern,page)
    for item in items:
        print item</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532179908865533-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532179908865533-2">2</div><div class="crayon-num" data-line="crayon-56bca5b532179908865533-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532179908865533-4">4</div><div class="crayon-num" data-line="crayon-56bca5b532179908865533-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532179908865533-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532179908865533-1"><span class="crayon-p">#获取每一层楼的内容,传入页面内容</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532179908865533-2"><span class="crayon-e">def </span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532179908865533-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532179908865533-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">items</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">findall</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532179908865533-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">item </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">items</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532179908865533-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-v">item</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>好，我们运行一下结果看一下</p>
<p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219235120.jpg"><img class="alignnone wp-image-1024 size-full" src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150219235120-e1424361136128.jpg" alt="20150219235120" width="1178" height="527" /></a></p>
<p>真是醉了，还有一大片换行符和图片符，好口怕！既然这样，我们就要对这些文本进行处理，把各种各样复杂的标签给它剔除掉，还原精华内容，把文本处理写成一个方法也可以，不过为了实现更好的代码架构和代码重用，我们可以考虑把标签等的处理写作一个类。</p>
<p>那我们就叫它Tool（工具类吧），里面定义了一个方法，叫replace，是替换各种标签的。在类中定义了几个正则表达式，主要利用了re.sub方法对文本进行匹配后然后替换。具体的思路已经写到注释中，大家可以看一下这个类</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b53217f334911609" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import re

#处理页面标签类
class Tool:
    #去除img标签,7位长空格
    removeImg = re.compile('&lt;img.*?&gt;| {7}|')
    #删除超链接标签
    removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;')
    #把换行的标签换为\n
    replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;')
    #将表格制表&lt;td&gt;替换为\t
    replaceTD= re.compile('&lt;td&gt;')
    #把段落开头换为\n加空两格
    replacePara = re.compile('&lt;p.*?&gt;')
    #将换行符或双换行符替换为\n
    replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;')
    #将其余标签剔除
    removeExtraTag = re.compile('&lt;.*?&gt;')
    def replace(self,x):
        x = re.sub(self.removeImg,"",x)
        x = re.sub(self.removeAddr,"",x)
        x = re.sub(self.replaceLine,"\n",x)
        x = re.sub(self.replaceTD,"\t",x)
        x = re.sub(self.replacePara,"\n    ",x)
        x = re.sub(self.replaceBR,"\n",x)
        x = re.sub(self.removeExtraTag,"",x)
        #strip()将前后多余内容删除
        return x.strip()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-2">2</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-4">4</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-6">6</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-8">8</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-10">10</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-12">12</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-14">14</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-16">16</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-18">18</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-20">20</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-22">22</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-24">24</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-26">26</div><div class="crayon-num" data-line="crayon-56bca5b53217f334911609-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53217f334911609-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b53217f334911609-1"><span class="crayon-e">import </span><span class="crayon-v">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-2">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b53217f334911609-3"><span class="crayon-p">#处理页面标签类</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-4"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Tool</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#去除img标签,7位长空格</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;img.*?&gt;| {7}|'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#删除超链接标签</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;a.*?&gt;|&lt;/a&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把换行的标签换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将表格制表&lt;td&gt;替换为\t</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceTD</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;td&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把段落开头换为\n加空两格</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replacePara</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;p.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将换行符或双换行符替换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceBR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将其余标签剔除</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeExtraTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeImg</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeAddr</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceLine</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceTD</span><span class="crayon-sy">,</span><span class="crayon-s">"\t"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replacePara</span><span class="crayon-sy">,</span><span class="crayon-s">"\n&nbsp;&nbsp;&nbsp;&nbsp;"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceBR</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeExtraTag</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53217f334911609-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#strip()将前后多余内容删除</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53217f334911609-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0061 seconds] -->
<p>在使用时，我们只需要初始化一下这个类，然后调用replace方法即可。</p>
<p>现在整体代码是如下这样子的，现在我的代码是写到这样子的</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532186595926714" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
__author__ = 'CQC'
# -*- coding:utf-8 -*-
import urllib
import urllib2
import re

#处理页面标签类
class Tool:
    #去除img标签,7位长空格
    removeImg = re.compile('&lt;img.*?&gt;| {7}|')
    #删除超链接标签
    removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;')
    #把换行的标签换为\n
    replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;')
    #将表格制表&lt;td&gt;替换为\t
    replaceTD= re.compile('&lt;td&gt;')
    #把段落开头换为\n加空两格
    replacePara = re.compile('&lt;p.*?&gt;')
    #将换行符或双换行符替换为\n
    replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;')
    #将其余标签剔除
    removeExtraTag = re.compile('&lt;.*?&gt;')
    def replace(self,x):
        x = re.sub(self.removeImg,"",x)
        x = re.sub(self.removeAddr,"",x)
        x = re.sub(self.replaceLine,"\n",x)
        x = re.sub(self.replaceTD,"\t",x)
        x = re.sub(self.replacePara,"\n    ",x)
        x = re.sub(self.replaceBR,"\n",x)
        x = re.sub(self.removeExtraTag,"",x)
        #strip()将前后多余内容删除
        return x.strip()


#百度贴吧爬虫类
class BDTB:

    #初始化，传入基地址，是否只看楼主的参数
    def __init__(self,baseUrl,seeLZ):
        self.baseURL = baseUrl
        self.seeLZ = '?see_lz='+str(seeLZ)
        self.tool = Tool()
    #传入页码，获取该页帖子的代码
    def getPage(self,pageNum):
        try:
            url = self.baseURL+ self.seeLZ + '&amp;pn=' + str(pageNum)
            request = urllib2.Request(url)
            response = urllib2.urlopen(request)
            return response.read().decode('utf-8')
        except urllib2.URLError, e:
            if hasattr(e,"reason"):
                print u"连接百度贴吧失败,错误原因",e.reason
                return None

    #获取帖子标题
    def getTitle(self):
        page = self.getPage(1)
        pattern = re.compile('&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;',re.S)
        result = re.search(pattern,page)
        if result:
            #print result.group(1)  #测试输出
            return result.group(1).strip()
        else:
            return None

    #获取帖子一共有多少页
    def getPageNum(self):
        page = self.getPage(1)
        pattern = re.compile('&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;',re.S)
        result = re.search(pattern,page)
        if result:
            #print result.group(1)  #测试输出
            return result.group(1).strip()
        else:
            return None

    #获取每一层楼的内容,传入页面内容
    def getContent(self,page):
        pattern = re.compile('&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S)
        items = re.findall(pattern,page)
        #for item in items:
        #  print item
        print self.tool.replace(items[1])
        

baseURL = 'http://tieba.baidu.com/p/3138733512'
bdtb = BDTB(baseURL,1)
bdtb.getContent(bdtb.getPage(1))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532186595926714-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-2">2</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-4">4</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-6">6</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-8">8</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-10">10</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-12">12</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-14">14</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-16">16</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-18">18</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-20">20</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-22">22</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-24">24</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-26">26</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-28">28</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-30">30</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-32">32</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-34">34</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-36">36</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-38">38</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-40">40</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-42">42</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-44">44</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-46">46</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-48">48</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-50">50</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-52">52</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-54">54</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-56">56</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-58">58</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-60">60</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-62">62</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-64">64</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-66">66</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-68">68</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-70">70</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-72">72</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-74">74</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-76">76</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-78">78</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-80">80</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-82">82</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-84">84</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-86">86</div><div class="crayon-num" data-line="crayon-56bca5b532186595926714-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532186595926714-88">88</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532186595926714-1"><span class="crayon-v">__author__</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'CQC'</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-2"><span class="crayon-p"># -*- coding:utf-8 -*-</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-3"><span class="crayon-e">import </span><span class="crayon-e">urllib</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-4"><span class="crayon-e">import </span><span class="crayon-e">urllib2</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-5"><span class="crayon-e">import </span><span class="crayon-v">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-6">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532186595926714-7"><span class="crayon-p">#处理页面标签类</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-8"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Tool</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#去除img标签,7位长空格</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;img.*?&gt;| {7}|'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#删除超链接标签</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;a.*?&gt;|&lt;/a&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把换行的标签换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将表格制表&lt;td&gt;替换为\t</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceTD</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;td&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把段落开头换为\n加空两格</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replacePara</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;p.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将换行符或双换行符替换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceBR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将其余标签剔除</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeExtraTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeImg</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeAddr</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceLine</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceTD</span><span class="crayon-sy">,</span><span class="crayon-s">"\t"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replacePara</span><span class="crayon-sy">,</span><span class="crayon-s">"\n&nbsp;&nbsp;&nbsp;&nbsp;"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceBR</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeExtraTag</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#strip()将前后多余内容删除</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-34">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532186595926714-35"><span class="crayon-p">#百度贴吧爬虫类</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-36"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">BDTB</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#初始化，传入基地址，是否只看楼主的参数</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">baseUrl</span><span class="crayon-sy">,</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">baseURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">baseUrl</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-41"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'?see_lz='</span><span class="crayon-o">+</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">tool</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tool</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#传入页码，获取该页帖子的代码</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">baseURL</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;pn='</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">request</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">Request</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">except </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-v">URLError</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">hasattr</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-s">"reason"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">"连接百度贴吧失败,错误原因"</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">reason</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-53"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-54">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532186595926714-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取帖子标题</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getTitle</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#print result.group(1)&nbsp;&nbsp;#测试输出</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">group</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-65">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取帖子一共有多少页</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getPageNum</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#print result.group(1)&nbsp;&nbsp;#测试输出</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">group</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-76">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532186595926714-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取每一层楼的内容,传入页面内容</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">items</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">findall</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#for item in items:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#&nbsp;&nbsp;print item</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">tool</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-v">items</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-85">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-86"><span class="crayon-v">baseURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://tieba.baidu.com/p/3138733512'</span></div><div class="crayon-line" id="crayon-56bca5b532186595926714-87"><span class="crayon-v">bdtb</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BDTB</span><span class="crayon-sy">(</span><span class="crayon-v">baseURL</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532186595926714-88"><span class="crayon-v">bdtb</span><span class="crayon-sy">.</span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-v">bdtb</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0161 seconds] -->
<p>我们尝试一下，重新再看一下效果，这下经过处理之后应该就没问题了，是不是感觉好酸爽！</p>
<p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000103.jpg"><img class="alignnone size-full wp-image-1025" src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000103.jpg" alt="20150220000103" width="1263" height="251" /></a></p>
<h3>4）替换楼层</h3>
<p>至于这个问题，我感觉直接提取楼层没什么必要呀，因为只看楼主的话，有些楼层的编号是间隔的，所以我们得到的楼层序号是不连续的，这样我们保存下来也没什么用。</p>
<p>所以可以尝试下面的方法：</p>
<blockquote><p>1.每打印输出一段楼层，写入一行横线来间隔，或者换行符也好。</p>
<p>2.试着重新编一个楼层，按照顺序，设置一个变量，每打印出一个结果变量加一，打印出这个变量当做楼层。</p></blockquote>
<p>这里我们尝试一下吧，看看效果怎样</p>
<p>把getContent方法修改如下</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b53218e187877353" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#获取每一层楼的内容,传入页面内容
def getContent(self,page):
    pattern = re.compile('&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S)
    items = re.findall(pattern,page)
    floor = 1
    for item in items:
        print floor,u"楼------------------------------------------------------------------------------------------------------------------------------------\n"
        print self.tool.replace(item)
        floor += 1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b53218e187877353-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53218e187877353-2">2</div><div class="crayon-num" data-line="crayon-56bca5b53218e187877353-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53218e187877353-4">4</div><div class="crayon-num" data-line="crayon-56bca5b53218e187877353-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53218e187877353-6">6</div><div class="crayon-num" data-line="crayon-56bca5b53218e187877353-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b53218e187877353-8">8</div><div class="crayon-num" data-line="crayon-56bca5b53218e187877353-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b53218e187877353-1"><span class="crayon-p">#获取每一层楼的内容,传入页面内容</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53218e187877353-2"><span class="crayon-e">def </span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53218e187877353-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53218e187877353-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">items</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">findall</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53218e187877353-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">floor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53218e187877353-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">item </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">items</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b53218e187877353-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-v">floor</span><span class="crayon-sy">,</span><span class="crayon-i">u</span><span class="crayon-s">"楼------------------------------------------------------------------------------------------------------------------------------------\n"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b53218e187877353-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">tool</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b53218e187877353-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">floor</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0021 seconds] -->
<p>运行一下看看效果</p>
<p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000947.jpg"><img class="alignnone size-full wp-image-1026" src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220000947.jpg" alt="20150220000947" width="1258" height="587" /></a></p>
<p>嘿嘿，效果还不错吧，感觉真酸爽！接下来我们完善一下，然后写入文件</p>
<h2>4.写入文件</h2>
<p>最后便是写入文件的过程，过程很简单，就几句话的代码而已，主要是利用了以下两句</p>
<blockquote><p>file = open(&#8220;tb.txt&#8221;,&#8221;w&#8221;)</p>
<p>file.writelines(obj)</p></blockquote>
<p>这里不再赘述，稍后直接贴上完善之后的代码。</p>
<h2>5.完善代码</h2>
<p>现在我们对代码进行优化，重构，在一些地方添加必要的打印信息，整理如下</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-56bca5b532195866457072" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
__author__ = 'CQC'
# -*- coding:utf-8 -*-
import urllib
import urllib2
import re

#处理页面标签类
class Tool:
    #去除img标签,7位长空格
    removeImg = re.compile('&lt;img.*?&gt;| {7}|')
    #删除超链接标签
    removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;')
    #把换行的标签换为\n
    replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;')
    #将表格制表&lt;td&gt;替换为\t
    replaceTD= re.compile('&lt;td&gt;')
    #把段落开头换为\n加空两格
    replacePara = re.compile('&lt;p.*?&gt;')
    #将换行符或双换行符替换为\n
    replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;')
    #将其余标签剔除
    removeExtraTag = re.compile('&lt;.*?&gt;')
    def replace(self,x):
        x = re.sub(self.removeImg,"",x)
        x = re.sub(self.removeAddr,"",x)
        x = re.sub(self.replaceLine,"\n",x)
        x = re.sub(self.replaceTD,"\t",x)
        x = re.sub(self.replacePara,"\n    ",x)
        x = re.sub(self.replaceBR,"\n",x)
        x = re.sub(self.removeExtraTag,"",x)
        #strip()将前后多余内容删除
        return x.strip()


#百度贴吧爬虫类
class BDTB:

    #初始化，传入基地址，是否只看楼主的参数
    def __init__(self,baseUrl,seeLZ,floorTag):
        #base链接地址
        self.baseURL = baseUrl
        #是否只看楼主
        self.seeLZ = '?see_lz='+str(seeLZ)
        #HTML标签剔除工具类对象
        self.tool = Tool()
        #全局file变量，文件写入操作对象
        self.file = None
        #楼层标号，初始为1
        self.floor = 1
        #默认的标题，如果没有成功获取到标题的话则会用这个标题
        self.defaultTitle = u"百度贴吧"
        #是否写入楼分隔符的标记
        self.floorTag = floorTag

    #传入页码，获取该页帖子的代码
    def getPage(self,pageNum):
        try:
            #构建URL
            url = self.baseURL+ self.seeLZ + '&amp;pn=' + str(pageNum)
            request = urllib2.Request(url)
            response = urllib2.urlopen(request)
            #返回UTF-8格式编码内容
            return response.read().decode('utf-8')
        #无法连接，报错
        except urllib2.URLError, e:
            if hasattr(e,"reason"):
                print u"连接百度贴吧失败,错误原因",e.reason
                return None

    #获取帖子标题
    def getTitle(self,page):
        #得到标题的正则表达式
        pattern = re.compile('&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;',re.S)
        result = re.search(pattern,page)
        if result:
            #如果存在，则返回标题
            return result.group(1).strip()
        else:
            return None

    #获取帖子一共有多少页
    def getPageNum(self,page):
        #获取帖子页数的正则表达式
        pattern = re.compile('&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;',re.S)
        result = re.search(pattern,page)
        if result:
            return result.group(1).strip()
        else:
            return None

    #获取每一层楼的内容,传入页面内容
    def getContent(self,page):
        #匹配所有楼层的内容
        pattern = re.compile('&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;',re.S)
        items = re.findall(pattern,page)
        contents = []
        for item in items:
            #将文本进行去除标签处理，同时在前后加入换行符
            content = "\n"+self.tool.replace(item)+"\n"
            contents.append(content.encode('utf-8'))
        return contents

    def setFileTitle(self,title):
        #如果标题不是为None，即成功获取到标题
        if title is not None:
            self.file = open(title + ".txt","w+")
        else:
            self.file = open(self.defaultTitle + ".txt","w+")

    def writeData(self,contents):
        #向文件写入每一楼的信息
        for item in contents:
            if self.floorTag == '1':
                #楼之间的分隔符
                floorLine = "\n" + str(self.floor) + u"-----------------------------------------------------------------------------------------\n"
                self.file.write(floorLine)
            self.file.write(item)
            self.floor += 1

    def start(self):
        indexPage = self.getPage(1)
        pageNum = self.getPageNum(indexPage)
        title = self.getTitle(indexPage)
        self.setFileTitle(title)
        if pageNum == None:
            print "URL已失效，请重试"
            return
        try:
            print "该帖子共有" + str(pageNum) + "页"
            for i in range(1,int(pageNum)+1):
                print "正在写入第" + str(i) + "页数据"
                page = self.getPage(i)
                contents = self.getContent(page)
                self.writeData(contents)
        #出现写入异常
        except IOError,e:
            print "写入异常，原因" + e.message
        finally:
            print "写入任务完成"



print u"请输入帖子代号"
baseURL = 'http://tieba.baidu.com/p/' + str(raw_input(u'http://tieba.baidu.com/p/'))
seeLZ = raw_input("是否只获取楼主发言，是输入1，否输入0\n")
floorTag = raw_input("是否写入楼层信息，是输入1，否输入0\n")
bdtb = BDTB(baseURL,seeLZ,floorTag)
bdtb.start()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-56bca5b532195866457072-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-2">2</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-4">4</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-6">6</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-8">8</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-10">10</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-12">12</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-14">14</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-16">16</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-18">18</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-20">20</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-22">22</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-24">24</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-26">26</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-28">28</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-30">30</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-32">32</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-34">34</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-36">36</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-38">38</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-40">40</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-42">42</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-44">44</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-46">46</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-48">48</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-50">50</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-52">52</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-54">54</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-56">56</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-58">58</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-60">60</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-62">62</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-64">64</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-66">66</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-68">68</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-70">70</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-72">72</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-74">74</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-76">76</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-78">78</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-80">80</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-82">82</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-84">84</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-86">86</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-88">88</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-90">90</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-92">92</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-94">94</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-96">96</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-98">98</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-100">100</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-102">102</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-104">104</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-106">106</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-108">108</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-110">110</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-112">112</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-114">114</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-116">116</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-118">118</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-120">120</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-122">122</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-124">124</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-126">126</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-128">128</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-130">130</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-132">132</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-134">134</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-136">136</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-138">138</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-140">140</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-142">142</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-144">144</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-146">146</div><div class="crayon-num" data-line="crayon-56bca5b532195866457072-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-56bca5b532195866457072-148">148</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-56bca5b532195866457072-1"><span class="crayon-v">__author__</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'CQC'</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-2"><span class="crayon-p"># -*- coding:utf-8 -*-</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-3"><span class="crayon-e">import </span><span class="crayon-e">urllib</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-4"><span class="crayon-e">import </span><span class="crayon-e">urllib2</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-5"><span class="crayon-e">import </span><span class="crayon-v">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-6">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-7"><span class="crayon-p">#处理页面标签类</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-8"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Tool</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#去除img标签,7位长空格</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;img.*?&gt;| {7}|'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#删除超链接标签</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;a.*?&gt;|&lt;/a&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把换行的标签换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将表格制表&lt;td&gt;替换为\t</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceTD</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;td&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把段落开头换为\n加空两格</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replacePara</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;p.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将换行符或双换行符替换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceBR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将其余标签剔除</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeExtraTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeImg</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeAddr</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceLine</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceTD</span><span class="crayon-sy">,</span><span class="crayon-s">"\t"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replacePara</span><span class="crayon-sy">,</span><span class="crayon-s">"\n&nbsp;&nbsp;&nbsp;&nbsp;"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceBR</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeExtraTag</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#strip()将前后多余内容删除</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-34">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-35"><span class="crayon-p">#百度贴吧爬虫类</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-36"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">BDTB</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#初始化，传入基地址，是否只看楼主的参数</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">baseUrl</span><span class="crayon-sy">,</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">,</span><span class="crayon-v">floorTag</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#base链接地址</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">baseURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">baseUrl</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#是否只看楼主</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'?see_lz='</span><span class="crayon-o">+</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#HTML标签剔除工具类对象</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">tool</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Tool</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#全局file变量，文件写入操作对象</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#楼层标号，初始为1</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">floor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#默认的标题，如果没有成功获取到标题的话则会用这个标题</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">defaultTitle</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">"百度贴吧"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#是否写入楼分隔符的标记</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">floorTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">floorTag</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-54">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#传入页码，获取该页帖子的代码</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#构建URL</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">baseURL</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">'&amp;pn='</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">request</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">Request</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#返回UTF-8格式编码内容</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#无法连接，报错</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">except </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-v">URLError</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">hasattr</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-s">"reason"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">"连接百度贴吧失败,错误原因"</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">reason</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-68"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-69">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取帖子标题</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getTitle</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#得到标题的正则表达式</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;h1 class="core_title_txt.*?&gt;(.*?)&lt;/h1&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#如果存在，则返回标题</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">group</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-80">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取帖子一共有多少页</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getPageNum</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-83"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取帖子页数的正则表达式</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;li class="l_reply_num.*?&lt;/span&gt;.*?&lt;span.*?&gt;(.*?)&lt;/span&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">search</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-e">group</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-88"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">None</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-90">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-91"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#获取每一层楼的内容,传入页面内容</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#匹配所有楼层的内容</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pattern</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div id="post_content_.*?&gt;(.*?)&lt;/div&gt;'</span><span class="crayon-sy">,</span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-v">S</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">items</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">findall</span><span class="crayon-sy">(</span><span class="crayon-v">pattern</span><span class="crayon-sy">,</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">contents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">item </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">items</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将文本进行去除标签处理，同时在前后加入换行符</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">content</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"\n"</span><span class="crayon-o">+</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">tool</span><span class="crayon-sy">.</span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">"\n"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">contents</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">content</span><span class="crayon-sy">.</span><span class="crayon-e">encode</span><span class="crayon-sy">(</span><span class="crayon-s">'utf-8'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">contents</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-102">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-103"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">setFileTitle</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">title</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#如果标题不是为None，即成功获取到标题</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">title </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-v">title</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">".txt"</span><span class="crayon-sy">,</span><span class="crayon-s">"w+"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">defaultTitle</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">".txt"</span><span class="crayon-sy">,</span><span class="crayon-s">"w+"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-109">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">writeData</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">contents</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#向文件写入每一楼的信息</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">item </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">contents</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">floorTag</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'1'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#楼之间的分隔符</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-115"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">floorLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"\n"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">floor</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">"-----------------------------------------------------------------------------------------\n"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-116"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">floorLine</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-117"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-v">item</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-118"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">floor</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-119">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-120"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-121"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">indexPage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-122"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">pageNum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPageNum</span><span class="crayon-sy">(</span><span class="crayon-v">indexPage</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-123"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">title</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getTitle</span><span class="crayon-sy">(</span><span class="crayon-v">indexPage</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-124"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">setFileTitle</span><span class="crayon-sy">(</span><span class="crayon-v">title</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-125"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">pageNum</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">None</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-126"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"URL已失效，请重试"</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-127"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-128"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-129"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"该帖子共有"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"页"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-130"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">pageNum</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-131"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"正在写入第"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"页数据"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getPage</span><span class="crayon-sy">(</span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">contents</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-v">page</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-134"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">writeData</span><span class="crayon-sy">(</span><span class="crayon-v">contents</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-135"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#出现写入异常</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-136"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">except </span><span class="crayon-v">IOError</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-137"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"写入异常，原因"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">message</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-138"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">finally</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-139"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-s">"写入任务完成"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-140">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-141">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-142">&nbsp;</div><div class="crayon-line" id="crayon-56bca5b532195866457072-143"><span class="crayon-i">print</span><span class="crayon-h"> </span><span class="crayon-i">u</span><span class="crayon-s">"请输入帖子代号"</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-144"><span class="crayon-v">baseURL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://tieba.baidu.com/p/'</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-e">raw_input</span><span class="crayon-sy">(</span><span class="crayon-i">u</span><span class="crayon-s">'http://tieba.baidu.com/p/'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-145"><span class="crayon-v">seeLZ</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">raw_input</span><span class="crayon-sy">(</span><span class="crayon-s">"是否只获取楼主发言，是输入1，否输入0\n"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-146"><span class="crayon-v">floorTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">raw_input</span><span class="crayon-sy">(</span><span class="crayon-s">"是否写入楼层信息，是输入1，否输入0\n"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-56bca5b532195866457072-147"><span class="crayon-v">bdtb</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BDTB</span><span class="crayon-sy">(</span><span class="crayon-v">baseURL</span><span class="crayon-sy">,</span><span class="crayon-v">seeLZ</span><span class="crayon-sy">,</span><span class="crayon-v">floorTag</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-56bca5b532195866457072-148"><span class="crayon-v">bdtb</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0276 seconds] -->
<p>现在程序演示如下</p>
<p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220012351.jpg"><img class="alignnone size-full wp-image-1028" src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20150220012351.jpg" alt="20150220012351" width="283" height="341" /></a></p>
<p>&nbsp;</p>
<p>完成之后，可以查看一下当前目录下多了一个以该帖子命名的txt文件，内容便是帖子的所有数据。</p>
<p>抓贴吧，就是这么简单和任性！</p>
<p>转载请注明：<a href="http://cuiqingcai.com">静觅</a> &raquo; <a href="http://cuiqingcai.com/993.html">Python爬虫实战二之爬取百度贴吧帖子</a></p>

      
<div class="article-social">
			<a href="javascript:;" data-action="ding" data-id="993" id="Addlike" class="action"><i class="fa fa-heart-o"></i>喜欢 (<span class="count">105</span>)</a><span class="or">or</span><span class="action action-share bdsharebuttonbox"><i class="fa fa-share-alt"></i>分享 (<span class="bds_count" data-cmd="count" title="累计分享0次">0</span>)<div class="action-popover"><div class="popover top in"><div class="arrow"></div><div class="popover-content"><a href="#" class="sinaweibo fa fa-weibo" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_qzone fa fa-star" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="tencentweibo fa fa-tencent-weibo" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="qq fa fa-qq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_renren fa fa-renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_more fa fa-ellipsis-h" data-cmd="more"></a></div></div></div></span>	
</div>
	</article>	
				<div style="background:#fff;padding-bottom:20px;font-size:14px;">
			<p style="text-align: center;margin-bottom:20px;padding:0px 20px">您的支持是博主写作最大的动力，如果您喜欢我的文章，感觉我的文章对您有帮助，请狠狠点击下面的</p>
			<p style="text-align: center;"><a href="http://cuiqingcai.com/donate"> <input style="width: 310px; margin: 10px auto 0px; background-color: #f58a87; color: #ffffff; height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" type="button" value="我要小额赞助" /></a>
		</div>
		<footer class="article-footer">
			<div class="article-tags"><i class="fa fa-tags"></i><a href="http://cuiqingcai.com/tag/python" rel="tag">Python</a><a href="http://cuiqingcai.com/tag/%e7%88%ac%e8%99%ab" rel="tag">爬虫</a></div>		</footer>
	<nav class="article-nav">
			<span class="article-nav-prev"><i class="fa fa-angle-double-left"></i> <a href="http://cuiqingcai.com/990.html" rel="prev">Python爬虫实战一之爬取糗事百科段子</a></span>
			<span class="article-nav-next"><a href="http://cuiqingcai.com/997.html" rel="next">Python爬虫实战三之计算大学本学期绩点</a>  <i class="fa fa-angle-double-right"></i></span>
		</nav>

		<div class="related_top">
			<div class="related_posts"><ul class="related_img">

		<li class="related_box"  >
		<a href="http://cuiqingcai.com/2443.html" title="Python爬虫进阶二之PySpider框架安装配置" target="_blank">
<img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2016/02/background.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="Python爬虫进阶二之PySpider框架安装配置" />	<br><span class="r_title">Python爬虫进阶二之PySpider框架安装配置</span></a>
		</li>
	
		<li class="related_box"  >
		<a href="http://cuiqingcai.com/2083.html" title="自己动手实现山东大学QLSC_STU无线网络掉线后自动重连" target="_blank">
<img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/wallpaper_5265780-e1454442805684.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="自己动手实现山东大学QLSC_STU无线网络掉线后自动重连" />	<br><span class="r_title">自己动手实现山东大学QLSC_STU无线网络掉线后自动重连</span></a>
		</li>
	
		<li class="related_box"  >
		<a href="http://cuiqingcai.com/1972.html" title="Python爬虫实战六之抓取爱问知识人问题并保存至数据库" target="_blank">
<img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/wallpaper_5265771.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="Python爬虫实战六之抓取爱问知识人问题并保存至数据库" />	<br><span class="r_title">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</span></a>
		</li>
	
		<li class="related_box"  >
		<a href="http://cuiqingcai.com/1707.html" title="Python中ValueError: invalid literal for int() with base 10 的实用解决办法" target="_blank">
<img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/wallpaper_5263464.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="Python中ValueError: invalid literal for int() with base 10 的实用解决办法" />	<br><span class="r_title">Python中ValueError: invalid literal for int() with base 10 的实用解决办法</span></a>
		</li>
	</ul>

<div class="relates">
<ul>
<li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/2443.html">Python爬虫进阶二之PySpider框架安装配置</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/2083.html">自己动手实现山东大学QLSC_STU无线网络掉线后自动重连</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/1972.html">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/1707.html">Python中ValueError: invalid literal for int() with base 10 的实用解决办法</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/1319.html">Python爬虫入门八之Beautiful Soup的用法</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/1076.html">Python爬虫实战五之模拟登录淘宝并获取所有订单</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/1052.html">Python爬虫学习系列教程</a></li><li><i class="fa fa-minus"></i><a href="http://cuiqingcai.com/1001.html">Python爬虫实战四之抓取淘宝MM照片</a></li>
</ul></div></div>		</div>
						<a name="comments"></a>
<div id="SOHUCS" sid="993"></div> 
<script type="text/javascript"> 
(function(){ 
    var appid = 'cyse2vKeA'; 
    var conf = 'prod_e440e40ef998fc11db594040d810aefb'; 
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
        window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); 
    } else { 
        var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("http://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); 
    }})(); 
</script>            
<div id="ds-ssr" style="display:none">
				<nav id="comment-nav-above">
			<h1 class="assistive-text">Comment navigation</h1>
			<div class="nav-previous"><a href="http://cuiqingcai.com/993.html/comment-page-2#comments" >&larr; Older Comments</a></div>
			<div class="nav-next"></div>
		</nav>
		            <ol id="commentlist">
                		<li class="comment even thread-even depth-1" id="li-comment-1215">
			<article id="comment-1215" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn">f</span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1215"><time pubdate datetime="2016-01-30T20:22:46+00:00">2016年1月30日 at 下午8:22</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>楼主~我做的时候发现在getcontent里面修改匹配的话能拿到那楼接下来的楼层数~然后再返回的列表里面第[0]照然后拼接上[1]加上换行~这样self.floor就可以省了</p>
</div>
				
			</article>
		<ul class="children">
		<li class="comment odd alt depth-2" id="li-comment-1216">
			<article id="comment-1216" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn">f</span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1216"><time pubdate datetime="2016-01-31T17:40:02+00:00">2016年1月31日 at 下午5:40</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>抱歉忘记说只是我需要这个功能~~</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment even thread-odd thread-alt depth-1" id="li-comment-1162">
			<article id="comment-1162" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://weibo.com/2509006933' rel='external nofollow' class='url'>芒果熊_XGM</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1162"><time pubdate datetime="2016-01-14T22:38:11+00:00">2016年1月14日 at 下午10:38</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>个人觉得楼主代码在getNum getPge getTitle函数中重复使用了getpage函数，这样会多次发送和接收数据，效率不高，能不能在全局变量中加入临时存放页面代码的变量，一次访问网络，获取所有信息呢</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-even depth-1" id="li-comment-1153">
			<article id="comment-1153" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://t.qq.com/ljn2043438' rel='external nofollow' class='url'>刘靖楠</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1153"><time pubdate datetime="2016-01-12T18:03:15+00:00">2016年1月12日 at 下午6:03</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>乱码已经解决：<br />
方法：# -*- coding:utf-8 -*- 第一行这个不变<br />
print response.read()改成print response.read().decode(&#8220;utf-8&#8243;)<br />
控制台即可正常输出</p>
</div>
				
			</article>
		<ul class="children">
		<li class="comment even depth-2" id="li-comment-1174">
			<article id="comment-1174" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn">JS</span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1174"><time pubdate datetime="2016-01-19T14:12:27+00:00">2016年1月19日 at 下午2:12</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>贴吧改版了，抓取内容的正则表达式老是匹配不上。请问您是怎么写的？</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-jim200511 odd alt thread-odd thread-alt depth-1" id="li-comment-1124">
			<article id="comment-1124" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://weibo.com/1908462881' rel='external nofollow' class='url'>有风的节奏</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1124"><time pubdate datetime="2015-12-25T23:21:27+00:00">2015年12月25日 at 下午11:21</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>楼主，现在贴吧改版了，内容该怎么匹配</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-1123">
			<article id="comment-1123" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://www.baidu.com/p/wolfbreak' rel='external nofollow' class='url'>wolfbreak</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1123"><time pubdate datetime="2015-12-25T17:49:40+00:00">2015年12月25日 at 下午5:49</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>十分感谢楼主的文章。不过，帖子后面是跟着有楼层和发帖时间的，我修改了一下提取楼层。正则表达式如下:<br />
(.*?)[sS]*?.*?<span class="tail-info">(d+).*?</span></p>
</div>
				
			</article>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-1028">
			<article id="comment-1028" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://weibo.com/2244671934' rel='external nofollow' class='url'>RONGWEIJUN丶</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1028"><time pubdate datetime="2015-11-15T20:21:21+00:00">2015年11月15日 at 下午8:21</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>乱码的改下<br />
import io<br />
self.file = io.open(&#8220;C:/Users/RONGW/Desktop/Python test/pachou/&#8221;+title + &#8220;.txt&#8221;,&#8221;w+&#8221;,encoding=&#8217;utf-8&#8242;)</p>
<p>self.file.write(item.decode(&#8216;utf-8&#8242;))</p>
</div>
				
			</article>
		<ul class="children">
		<li class="comment byuser comment-author-cqcre bypostauthor even depth-2" id="li-comment-1254">
			<article id="comment-1254" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://cuiqingcai.com/' rel='external nofollow' class='url'>崔庆才</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1254"><time pubdate datetime="2016-02-01T20:46:29+00:00">2016年2月1日 at 下午8:46</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>谢谢提醒</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-atob odd alt thread-even depth-1" id="li-comment-986">
			<article id="comment-986" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://t.qq.com/d91013991' rel='external nofollow' class='url'>DD</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-986"><time pubdate datetime="2015-11-04T15:43:09+00:00">2015年11月4日 at 下午3:43</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>楼主，我把文件的txt格式改为了py保存，才没有出现中文乱码，能不能说明一下，如果要用txt正确保存，应该怎么书写</p>
</div>
				
			</article>
		<ul class="children">
		<li class="comment byuser comment-author-cqcre bypostauthor even depth-2" id="li-comment-1020">
			<article id="comment-1020" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://cuiqingcai.com/' rel='external nofollow' class='url'>崔庆才</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1020"><time pubdate datetime="2015-11-13T20:33:59+00:00">2015年11月13日 at 下午8:33</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>其实每个文件都有编码格式，改一下编码格式就好</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cqcre bypostauthor odd alt depth-2" id="li-comment-1253">
			<article id="comment-1253" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://cuiqingcai.com/' rel='external nofollow' class='url'>崔庆才</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-1253"><time pubdate datetime="2016-02-01T20:46:20+00:00">2016年2月1日 at 下午8:46</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>你也需要改一下txt文本的编码格式</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
		<li class="duoshuo even thread-odd thread-alt depth-1" id="li-comment-972">
			<article id="comment-972" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://t.qq.com/linhuavv' rel='external nofollow' class='url'>hvv</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-972"><time pubdate datetime="2015-10-27T21:56:50+00:00">2015年10月27日 at 下午9:56</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>楼主的decode（）与encode（）理解可能有问题或者是备注有问题，decode是将（）里面的转换为unicode编码，encode是将unicode转换为（）里面的编码，写得挺好的，谢谢楼主！</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
		<li class="duoshuo odd alt thread-even depth-1" id="li-comment-918">
			<article id="comment-918" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn">han</span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-918"><time pubdate datetime="2015-10-16T16:06:22+00:00">2015年10月16日 at 下午4:06</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>请问要怎么解决文件内容乱码的问题？</p>
</div>
				
			</article>
		<ul class="children">
		<li class="duoshuo byuser comment-author-cqcre bypostauthor even depth-2" id="li-comment-959">
			<article id="comment-959" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://cuiqingcai.com/' rel='external nofollow' class='url'>崔庆才</a></span> on <a rel="nofollow" href="http://cuiqingcai.com/993.html/comment-page-3#comment-959"><time pubdate datetime="2015-10-25T22:41:35+00:00">2015年10月25日 at 下午10:41</time></a> <span class="says">said:</span>					</cite>
				</footer>
	
				<div class="comment-content"><p>都统一设置为utf-8</p>
</div>
				
			</article>
		</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
            </ol>

				<nav id="comment-nav-below">
			<h1 class="assistive-text">Comment navigation</h1>
			<div class="nav-previous"><a href="http://cuiqingcai.com/993.html/comment-page-2#comments" >&larr; Older Comments</a></div>
			<div class="nav-next"></div>
		</nav>
		    </div>
			</div>
</div>
<aside class="sidebar">	
<div class="widget widget_text"><div class="textwidget"><div class="social">

<a href="http://weibo.com/u/2830678474" rel="external nofollow" title="新浪微博" target="_blank"><i class="sinaweibo fa fa-weibo"></i></a><a  href="http://t.qq.com/CQCcqc123456?preview" rel="external nofollow" title="腾讯微博" target="_blank"><i class="tencentweibo fa fa-tencent-weibo"></i></a><a class="weixin"><i class="weixins fa fa-weixin"></i><div class="weixin-popover"><div class="popover bottom in"><div class="arrow"></div><div class="popover-title"></div><div class="popover-content"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/img/weixin.gif" ></div></div></div></a>
<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=cqc@cuiqingcai.com" rel="external nofollow" title="Email" target="_blank"><i class="email fa fa-envelope-o"></i></a><a href="?feed=rss2" rel="external nofollow" target="_blank"  title="订阅本站"><i class="rss fa fa-rss"></i></a>
</div></div></div>

<div class="widget widget_archive"><div class="title"><h2>文章归档</h2></div>		<ul>
	<li><a href='http://cuiqingcai.com/date/2016/02'>2016年二月</a></li>
	<li><a href='http://cuiqingcai.com/date/2016/01'>2016年一月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/12'>2015年十二月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/11'>2015年十一月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/10'>2015年十月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/09'>2015年九月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/08'>2015年八月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/07'>2015年七月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/06'>2015年六月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/05'>2015年五月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/04'>2015年四月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/03'>2015年三月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/02'>2015年二月</a></li>
	<li><a href='http://cuiqingcai.com/date/2015/01'>2015年一月</a></li>
	<li><a href='http://cuiqingcai.com/date/2014/12'>2014年十二月</a></li>
	<li><a href='http://cuiqingcai.com/date/2014/11'>2014年十一月</a></li>
	<li><a href='http://cuiqingcai.com/date/2014/10'>2014年十月</a></li>
	<li><a href='http://cuiqingcai.com/date/2014/09'>2014年九月</a></li>
		</ul>
</div><div class="widget widget_links"><div class="title"><h2>热门专题</h2></div>
	<ul class='xoxo blogroll'>
<li><a href="http://cuiqingcai.com/1052.html" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5254665-e1424499272248.jpg"  alt="Python爬虫"  /> Python爬虫</a></li>
<li><a href="http://cuiqingcai.com/1479.html"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2016/02/23.jpg"  alt="PHP高级特性"  /> PHP高级特性</a></li>
<li><a href="http://cuiqingcai.com/2469.html" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2016/02/17.jpg"  alt="JavaScript"  /> JavaScript</a></li>
<li><a href="http://cuiqingcai.com/2467.html" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2016/02/15.jpg"  alt="OpenGL绘图"  /> OpenGL绘图</a></li>

	</ul>
</div>
<div class="widget widget_text"><div class="title"><h2>原创游戏</h2></div>			<div class="textwidget"><div class="taobaotextad">
<p style="
    margin-left: 20px;
    color: #00a67c;
">BallEscape丨博主开发的一款休闲益智虐心游戏 </p><p style="
    margin-left: 10px;
">
<a href="http://res.cuiqingcai.com/ballescape/">
<input type="button" value="了解更多" style="width: 310px; margin: 10px auto 0px; background-color: rgb(245, 138, 135); color: rgb(255, 255, 255); height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" onmouseover="this.style.backgroundColor='rgb(252, 125, 121)'" onmouseout="this.style.backgroundColor='#F58A87'"></a>
</p></div></div>
		</div><div class="widget d_postlist"><div class="title"><h2>猜你喜欢</h2></div><ul><li><a href="http://cuiqingcai.com/990.html" title="Python爬虫实战一之爬取糗事百科段子" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5228661.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战一之爬取糗事百科段子" /></span><span class="text">Python爬虫实战一之爬取糗事百科段子</span><span class="muted">2015-02-17</span><span class="muted">177评论</span></a></li>
<li><a href="http://cuiqingcai.com/1076.html" title="Python爬虫实战五之模拟登录淘宝并获取所有订单" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5226152.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战五之模拟登录淘宝并获取所有订单" /></span><span class="text">Python爬虫实战五之模拟登录淘宝并获取所有订单</span><span class="muted">2015-02-24</span><span class="muted">99评论</span></a></li>
<li><a href="http://cuiqingcai.com/1001.html" title="Python爬虫实战四之抓取淘宝MM照片" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5270641.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战四之抓取淘宝MM照片" /></span><span class="text">Python爬虫实战四之抓取淘宝MM照片</span><span class="muted">2015-02-20</span><span class="muted">98评论</span></a></li>
<li><a href="http://cuiqingcai.com/993.html" title="Python爬虫实战二之爬取百度贴吧帖子" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5265936.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战二之爬取百度贴吧帖子" /></span><span class="text">Python爬虫实战二之爬取百度贴吧帖子</span><span class="muted">2015-02-17</span><span class="muted">65评论</span></a></li>
<li><a href="http://cuiqingcai.com/1052.html" title="Python爬虫学习系列教程" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5254665-e1424499272248.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫学习系列教程" /></span><span class="text">Python爬虫学习系列教程</span><span class="muted">2015-02-21</span><span class="muted">56评论</span></a></li>
<li><a href="http://cuiqingcai.com/968.html" title="Python爬虫入门六之Cookie的使用" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5258536-1.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门六之Cookie的使用" /></span><span class="text">Python爬虫入门六之Cookie的使用</span><span class="muted">2015-02-15</span><span class="muted">48评论</span></a></li>
<li><a href="http://cuiqingcai.com/997.html" title="Python爬虫实战三之计算大学本学期绩点" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5265978.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战三之计算大学本学期绩点" /></span><span class="text">Python爬虫实战三之计算大学本学期绩点</span><span class="muted">2015-02-20</span><span class="muted">39评论</span></a></li>
<li><a href="http://cuiqingcai.com/1319.html" title="Python爬虫入门八之Beautiful Soup的用法" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/03/wallpaper_52546561.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门八之Beautiful Soup的用法" /></span><span class="text">Python爬虫入门八之Beautiful Soup的用法</span><span class="muted">2015-03-11</span><span class="muted">37评论</span></a></li>
<li><a href="http://cuiqingcai.com/947.html" title="Python爬虫入门三之Urllib库的基本使用" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5226849-1.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门三之Urllib库的基本使用" /></span><span class="text">Python爬虫入门三之Urllib库的基本使用</span><span class="muted">2015-02-13</span><span class="muted">27评论</span></a></li>
<li><a href="http://cuiqingcai.com/977.html" title="Python爬虫入门七之正则表达式" ><span class="thumbnail"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5270713.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门七之正则表达式" /></span><span class="text">Python爬虫入门七之正则表达式</span><span class="muted">2015-02-15</span><span class="muted">23评论</span></a></li>
</ul></div><div class="widget widget_text"><div class="title"><h2>我要投稿</h2></div>			<div class="textwidget"><div class="taobaotextad">
<p style="
    margin-left: 20px;
    color: #00a67c;
">想让自己的文章出现在这里吗?赶快注册投稿吧！</p><p style="
    margin-left: 10px;
">
<a href="http://cuiqingcai.com/wp-login.php?action=register">
<input type="button" value="点我投稿" style="width: 310px; margin: 10px auto 0px; background-color: rgb(245, 138, 135); color: rgb(255, 255, 255); height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" onmouseover="this.style.backgroundColor='rgb(252, 125, 121)'" onmouseout="this.style.backgroundColor='#F58A87'"></a>
</p></div></div>
		</div><div class="widget d_tag"><div class="title"><h2>标签云</h2></div><div class="d_tags"><a title="27个话题" href="http://cuiqingcai.com/tag/php">PHP (27)</a><a title="20个话题" href="http://cuiqingcai.com/tag/python">Python (20)</a><a title="16个话题" href="http://cuiqingcai.com/tag/%e7%88%ac%e8%99%ab">爬虫 (16)</a><a title="16个话题" href="http://cuiqingcai.com/tag/js">JS (16)</a><a title="11个话题" href="http://cuiqingcai.com/tag/opengl">OpenGL (11)</a><a title="10个话题" href="http://cuiqingcai.com/tag/html">HTML (10)</a><a title="8个话题" href="http://cuiqingcai.com/tag/jquery">jQuery (8)</a><a title="7个话题" href="http://cuiqingcai.com/tag/linux">Linux (7)</a><a title="7个话题" href="http://cuiqingcai.com/tag/winpcap">Winpcap (7)</a><a title="6个话题" href="http://cuiqingcai.com/tag/wordpress">WordPress (6)</a><a title="6个话题" href="http://cuiqingcai.com/tag/security">Security (6)</a><a title="4个话题" href="http://cuiqingcai.com/tag/git">Git (4)</a><a title="4个话题" href="http://cuiqingcai.com/tag/net">Net (4)</a><a title="3个话题" href="http://cuiqingcai.com/tag/java">Java (3)</a><a title="3个话题" href="http://cuiqingcai.com/tag/mysql">Mysql (3)</a><a title="2个话题" href="http://cuiqingcai.com/tag/cocos2d-x">Cocos2d-x (2)</a><a title="2个话题" href="http://cuiqingcai.com/tag/jsp">JSP (2)</a><a title="2个话题" href="http://cuiqingcai.com/tag/matlab">Matlab (2)</a><a title="2个话题" href="http://cuiqingcai.com/tag/bootstrap">Bootstrap (2)</a><a title="2个话题" href="http://cuiqingcai.com/tag/photoshop">Photoshop (2)</a><a title="2个话题" href="http://cuiqingcai.com/tag/css">CSS (2)</a><a title="1个话题" href="http://cuiqingcai.com/tag/json">Json (1)</a><a title="1个话题" href="http://cuiqingcai.com/tag/redis">Redis (1)</a><a title="1个话题" href="http://cuiqingcai.com/tag/less">LESS (1)</a><a title="1个话题" href="http://cuiqingcai.com/tag/nginx">Nginx (1)</a></div></div><div class="widget widget_links"><div class="title"><h2>友情链接</h2></div>
	<ul class='xoxo blogroll'>
<li><a href="http://www.anotherhome.net" target="_blank">Anotherhome</a></li>
<li><a href="http://zhouchenwen.com" rel="acquaintance" target="_blank">ColdCoder</a></li>
<li><a href="http://www.findspace.name" target="_blank">Findspace</a></li>
<li><a href="http://blog.hickwu.com/" target="_blank">Hick</a></li>
<li><a href="http://www.nopcn.com" target="_blank">nopcommerce</a></li>
<li><a href="http://wonderlee.me">Wonder’s Land</a></li>
<li><a href="http://www.atrail.cn/" target="_blank">从前以后</a></li>
<li><a href="http://www.superqq.com/">刚刚在线</a></li>
<li><a href="http://www.lvtao.net" target="_blank">吕滔博客</a></li>
<li><a href="http://www.fddcn.cn" target="_blank">奋斗的承诺</a></li>
<li><a href="http://www.zuilizhi.net/" target="_blank">最励志网</a></li>
<li><a href="http://www.lishengcn.cn/" target="_blank">李胜的脚步</a></li>
<li><a href="http://liaoyuming.cn" rel="acquaintance" target="_blank">永远站</a></li>
<li><a href="http://www.hubwiz.com" target="_blank">汇智网</a></li>
<li><a href="http://www.zoeys.cn/" target="_blank">糊糊</a></li>
<li><a href="http://www.leyle.com/" target="_blank">遗落岛</a></li>

	</ul>
</div>
<div class="widget widget_text"><div class="title"><h2>休闲一下</h2></div>			<div class="textwidget"><div class="taobaotextad">
<p style="
    margin-left: 20px;
    color: #00a67c;
">累了吧？玩个游戏休息一下吧 </p><p style="
    margin-left: 10px;
">
<a href="http://res.cuiqingcai.com/2048">
<input type="button" value="放松一下" style="width: 310px; margin: 10px auto 0px; background-color: rgb(245, 138, 135); color: rgb(255, 255, 255); height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" onmouseover="this.style.backgroundColor='rgb(252, 125, 121)'" onmouseout="this.style.backgroundColor='#F58A87'"></a>
</p></div></div>
		</div><div class="widget widget_text"><div class="title"><h2>新浪微博</h2></div>			<div class="textwidget"><iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=1&isFans=1&uid=2830678474&verifier=7468dc7b&dpc=1"></iframe></div>
		</div><div class="widget widget_text"><div class="title"><h2>精品推荐</h2></div>			<div class="textwidget"><div class = "taobaotextad">
<script type="text/javascript">
var cpro_id="u1974136";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"338",rsi1:"330",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"",rss2:"#00a67c",titSU:"0",ptbg:"70",piw:"130",pih:"80",ptp:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</div></div>
		</div></aside></section>
<footer class="footer">
    <div class="footer-inner">
        <div class="copyright pull-left">
         <a href="http://cuiqingcai.com " title="静觅">静觅</a> 版权所有丨采用<a href="http://yusi123.com/"> 欲思 </a>主题丨基于<a href="http://cn.wordpress.org/" title="WordPress"> WordPress </a>构建   © 2015丨托管于 <a rel="nofollow" target="_blank" href="http://www.aliyun.com/">阿里云主机</a> & <a rel="nofollow" target="_blank" href="http://www.qiniu.com/">七牛云存储 </a>丨鲁ICP备14030596号
		 <div>
			<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253486800'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1253486800%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
		 </div>
		</div>
        
    </div>
</footer>

<script type='text/javascript'>
/* <![CDATA[ */
var viewsCacheL10n = {"admin_ajax_url":"http:\/\/cuiqingcai.com\/wp-admin\/admin-ajax.php","post_id":"993"};
/* ]]> */
</script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/plugins/wp-postviews/postviews-cache.js?ver=1.68'></script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/themes/Yusi/js/jquery.js?ver=1.0'></script>
<script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/36e5)];</script><!-- xuanfu -->
 <script type="text/javascript">
    /*300*25 创建于 2015-02-23*/
    var cpro_id = "u1959047";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/s.js" type="text/javascript"></script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3ef185224776ec2561c9f7066ead4f24' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>
<!-- Dynamic page generated in 0.418 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2016-02-11 23:16:05 -->

<!-- super cache -->